openapi: 3.0.0
info:
  title: Complex Nested Schemas Test
  version: 1.0.0
  description: Test arbitrary depth nesting (3+ levels) without stack overflow
paths:
  /company/{id}:
    get:
      operationId: getCompanyById
      tags:
        - company
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Company with deep nesting
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Company'
components:
  schemas:
    Company:
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
        name:
          type: string
        locations:
          type: array
          items:
            $ref: '#/components/schemas/Location'
        headquarters:
          $ref: '#/components/schemas/Location'
    Location:
      type: object
      required:
        - id
        - address
      properties:
        id:
          type: integer
        name:
          type: string
        address:
          $ref: '#/components/schemas/Address'
        departments:
          type: array
          items:
            $ref: '#/components/schemas/Department'
    Address:
      type: object
      required:
        - street
        - city
      properties:
        street:
          type: string
        city:
          type: string
        state:
          type: string
        postalCode:
          type: string
        country:
          type: string
        coordinates:
          $ref: '#/components/schemas/Coordinates'
        nearbyLocations:
          type: array
          items:
            $ref: '#/components/schemas/Location'
    Coordinates:
      type: object
      required:
        - latitude
        - longitude
      properties:
        latitude:
          type: number
          format: double
        longitude:
          type: number
          format: double
        altitude:
          type: number
          format: double
    Department:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        manager:
          $ref: '#/components/schemas/Employee'
        employees:
          type: array
          items:
            $ref: '#/components/schemas/Employee'
    Employee:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        address:
          $ref: '#/components/schemas/Address'
